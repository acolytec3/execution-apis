"use strict";(self.webpackChunkexecution_apis=self.webpackChunkexecution_apis||[]).push([[8187],{30929:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var a=n(28453),l=n(96540);function r(e){const t=Object.assign({h1:"h1",p:"p",h2:"h2",code:"code",pre:"pre",ul:"ul",li:"li",h3:"h3",ol:"ol"},(0,a.RP)(),e.components);return l.createElement(l.Fragment,null,l.createElement(t.h1,{id:"eth_simulate"},"eth_simulate"),"\n",l.createElement(t.p,null,"This document contains some extra information that couldn't be fit to the specification document directly."),"\n",l.createElement(t.h2,{id:"default-block-values"},"Default block values"),"\n",l.createElement(t.p,null,"Unlike ",l.createElement(t.code,null,"eth_call"),", ",l.createElement(t.code,null,"eth_simulateV1"),"'s calls are conducted inside blocks. We don't require user to define all the fields of the blocks so here are the defaults that are assumed for blocks parameters:"),"\n",l.createElement(t.p,null,"| parameter name | default value |\n-----------------|-----------------------\n| prevRandao | ",l.createElement(t.code,null,"0x0000000000000000000000000000000000000000000000000000000000000000")," |\n| feeRecipient | ",l.createElement(t.code,null,"0x0000000000000000000000000000000000000000")," |\n| mixHash | ",l.createElement(t.code,null,"0x0000000000000000000000000000000000000000000000000000000000000000")," |\n| nonce | ",l.createElement(t.code,null,"0x0")," |\n| extraData | ",l.createElement(t.code,null,"0x0000000000000000000000000000000000000000000000000000000000000000")," |\n| difficulty | The same as the base block defined as the second parameter in the call |\n| gasLimit | The same as the base block defined as the second parameter in the call |\n| hash | Calculated normally |\n| parentHash | Previous blocks hash |\n| timestamp | The timestamp of previous block + ",l.createElement(t.code,null,"network block time")," (12s on Ethereum Mainnet) |\n| baseFeePerGas | When validation mode is true, baseFeePerGas is calculated on what it should be according to Ethereum's spec. When validation mode is false, the baseFeePerGas is set to zero |\n| sha3Uncles | Empty trie root |\n| withdrawals | Empty array |\n| uncles | Empty array |\n| blobBaseFee | When validation mode is true, blobBaseFee is calculated on what it should be according to EIP-4844 spec. When validation mode is false, the blobBaseFee is set to zero |\n| number | Previous block number + 1 |\n| logsBloom | Calculated normally. ETH logs are not part of the calculation |\n| receiptsRoot | Calculated normally |\n| transactionsRoot | Calculated normally |\n| size | Calculated normally |\n| withdrawalsRoot | Calculated normally |\n| gasUsed | Calculated normally |\n| stateRoot | Calculated normally |"),"\n",l.createElement(t.h2,{id:"default-values-for-transactions"},"Default values for transactions"),"\n",l.createElement(t.p,null,"As eth_simulate is an extension to ",l.createElement(t.code,null,"eth_call")," we want to enable the nice user experience that the user does not need to provide all required values for a transaction. We are assuming following defaults if the variable is not provided by the user:\n| parameter name | description |\n-----------------|-----------------------\n| type | ",l.createElement(t.code,null,"0x2")," |\n| nonce | Take the correct nonce for the account prior eth_simulate and increment by one for each transaction by the account |\n| to | ",l.createElement(t.code,null,"null")," |\n| from | ",l.createElement(t.code,null,"0x0000000000000000000000000000000000000000")," |\n| gasLimit | blockGasLimit - soFarUsedGasInBlock |\n| value | ",l.createElement(t.code,null,"0x0")," |\n| input | no data |\n| gasPrice | ",l.createElement(t.code,null,"0x0")," |\n| maxPriorityFeePerGas | ",l.createElement(t.code,null,"0x0")," |\n| maxFeePerGas | ",l.createElement(t.code,null,"0x0")," |\n| accessList | empty array |\n| blobVersionedHashes | empty array |\n| chainId | The chain id of the current chain |\n| r | ",l.createElement(t.code,null,"0x0")," |\n| s | ",l.createElement(t.code,null,"0x0")," |\n| yParity | even |\n| v | ",l.createElement(t.code,null,"0x0")," |"),"\n",l.createElement(t.h2,{id:"overriding-default-values"},"Overriding default values"),"\n",l.createElement(t.p,null,"The default values of blocks and transactions can be overriden. For Transactions we allow overriding of variables ",l.createElement(t.code,null,"type"),", ",l.createElement(t.code,null,"nonce"),", ",l.createElement(t.code,null,"to"),", ",l.createElement(t.code,null,"from"),", ",l.createElement(t.code,null,"gas limit"),", ",l.createElement(t.code,null,"value"),", ",l.createElement(t.code,null,"input"),", ",l.createElement(t.code,null,"gasPrice"),", ",l.createElement(t.code,null,"maxPriorityFeePerGas"),", ",l.createElement(t.code,null,"maxFeePerGas"),", ",l.createElement(t.code,null,"accessList"),", and for blocks we allow modifications of ",l.createElement(t.code,null,"number"),", ",l.createElement(t.code,null,"time"),", ",l.createElement(t.code,null,"gasLimit"),", ",l.createElement(t.code,null,"feeRecipient"),", ",l.createElement(t.code,null,"prevRandao"),", ",l.createElement(t.code,null,"baseFeePerGas")," and ",l.createElement(t.code,null,"blobBaseFee"),":"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-json"},'"blockOverrides": {\n\t"number": "0x14",\n\t"time": "0xc8",\n\t"gasLimit": "0x2e631",\n\t"feeRecipient": "0xc100000000000000000000000000000000000000",\n\t"prevRandao": "0x0000000000000000000000000000000000000000000000000000000000001234",\n\t"baseFeePerGas": "0x14",\n\t"blobBaseFee": "0x15"\n},\n')),"\n",l.createElement(t.p,null,"All the other fields are computed automatically (eg, ",l.createElement(t.code,null,"stateRoot")," and ",l.createElement(t.code,null,"gasUsed"),") or kept as their default values (eg. ",l.createElement(t.code,null,"uncles")," or ",l.createElement(t.code,null,"withdrawals"),"). When overriding ",l.createElement(t.code,null,"number")," and ",l.createElement(t.code,null,"time")," variables for blocks, we automatically check that the block numbers and time fields are strictly increasing (we don't allow decreasing, or duplicated block numbers or times). If the block number is increased more than ",l.createElement(t.code,null,"1")," compared to the previous block, new empty blocks are generated in between."),"\n",l.createElement(t.p,null,"An interesting note here is that an user can specify block numbers and times of some blocks, but not for others. When block numbers of times are left unspecified, the default values will be used. After the blocks have been constructed, and default values are calculated, the blocks are checked that their block numbers and times are still valid."),"\n",l.createElement(t.h2,{id:"eth-transfer-logs"},"ETH transfer logs"),"\n",l.createElement(t.p,null,"When ",l.createElement(t.code,null,"traceTransfers")," setting is enabled on ",l.createElement(t.code,null,"eth_simulateV1"),', eth_simulate will return logs for ethereum transfers along with the normal logs sent by contracts. The ETH transfers are identical to ERC20 transfers, except the "sending contract" is address ',l.createElement(t.code,null,"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"),"."),"\n",l.createElement(t.p,null,"For example, here's a query that will simply send ether from one address to another (with a state override that gives us the ETH initially):"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-json"},'{\n\t"jsonrpc": "2.0",\n\t"id": 1,\n\t"method": "eth_simulateV1",\n\t"params": [\n\t\t{\n\t\t\t"blockStateCalls": [\n\t\t\t\t{\n\t\t\t\t\t"stateOverrides": {\n\t\t\t\t\t\t"0xc000000000000000000000000000000000000000": {\n\t\t\t\t\t\t\t"balance": "0x7d0"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t"calls": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t"from": "0xc000000000000000000000000000000000000000",\n\t\t\t\t\t\t\t"to": "0xc100000000000000000000000000000000000000",\n\t\t\t\t\t\t\t"value": "0x3e8"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t],\n\t\t\t"traceTransfers": true\n\t\t},\n\t\t"latest"\n\t]\n}\n')),"\n",l.createElement(t.p,null,"The output of this query is:"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-json"},'{\n\t"jsonrpc": "2.0",\n\t"id": 1,\n\t"result": [\n\t\t{\n\t\t\t"number": "0x4",\n\t\t\t"hash": "0x859c932c5cf0dabf8d12eb2518e063966ac1a25e2fc49f1f02574a37f358d0b5",\n\t\t\t"timestamp": "0x1f",\n\t\t\t"gasLimit": "0x4c4b40",\n\t\t\t"gasUsed": "0x5208",\n\t\t\t"feeRecipient": "0x0000000000000000000000000000000000000000",\n\t\t\t"baseFeePerGas": "0x2310a91d",\n\t\t\t"prevRandao": "0x0000000000000000000000000000000000000000000000000000000000000000",\n\t\t\t"calls": [\n\t\t\t\t{\n\t\t\t\t\t"returnData": "0x",\n\t\t\t\t\t"logs": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t"address": "0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",\n\t\t\t\t\t\t\t"topics": [\n\t\t\t\t\t\t\t\t"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",\n\t\t\t\t\t\t\t\t"0x000000000000000000000000c000000000000000000000000000000000000000",\n\t\t\t\t\t\t\t\t"0x000000000000000000000000c100000000000000000000000000000000000000"\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t"data": "0x00000000000000000000000000000000000000000000000000000000000003e8",\n\t\t\t\t\t\t\t"blockNumber": "0x4",\n\t\t\t\t\t\t\t"transactionHash": "0xa4d41019e71335f8567e17746b708ddda8b975a9a61f909bd3df55f4866cc913",\n\t\t\t\t\t\t\t"transactionIndex": "0x0",\n\t\t\t\t\t\t\t"blockHash": "0x859c932c5cf0dabf8d12eb2518e063966ac1a25e2fc49f1f02574a37f358d0b5",\n\t\t\t\t\t\t\t"logIndex": "0x0",\n\t\t\t\t\t\t\t"removed": false\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t"gasUsed": "0x5208",\n\t\t\t\t\t"status": "0x1"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t]\n}\n')),"\n",l.createElement(t.p,null,"Here the interesting part is:"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-json"},'"address": "0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",\n"topics": [\n\t"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",\n\t"0x000000000000000000000000c000000000000000000000000000000000000000",\n\t"0x000000000000000000000000c100000000000000000000000000000000000000"\n],\n"data": "0x00000000000000000000000000000000000000000000000000000000000003e8",\n')),"\n",l.createElement(t.p,null,"In the observed event, the sender address is denoted as the ",l.createElement(t.code,null,"0xee...")," address. The first topic (",l.createElement(t.code,null,"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),") aligns with the event signature ",l.createElement(t.code,null,"Transfer(address,address,uint256)"),", while the second topic (",l.createElement(t.code,null,"0x000000000000000000000000c000000000000000000000000000000000000000"),") corresponds to the sending address, and the third topic (",l.createElement(t.code,null,"0x000000000000000000000000c100000000000000000000000000000000000000"),") represents the receiving address. The quantity of ETH transacted is stored in the data field."),"\n",l.createElement(t.p,null,"The ETH logs will contain following types of ETH transfers:"),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"Transfering ETH from EOA"),"\n",l.createElement(t.li,null,"Transfering ETH via contract"),"\n",l.createElement(t.li,null,"Selfdestructing contract sending ETH"),"\n"),"\n",l.createElement(t.p,null,"But not following ones:"),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"Gas fees"),"\n",l.createElement(t.li,null,"eth_simulates eth balance override"),"\n"),"\n",l.createElement(t.p,null,"ETH logs are not part of the calculation for logs bloom filter. Also, similar to normal logs, if the transaction sends ETH but the execution reverts, no log gets issued."),"\n",l.createElement(t.h2,{id:"validation-mode"},"Validation Mode"),"\n",l.createElement(t.p,null,"The ",l.createElement(t.code,null,"eth_simulate")," includes a feature to enable or disable validation using the ",l.createElement(t.code,null,"Validation")," setting. By default, validation is off, and ",l.createElement(t.code,null,"eth_simulate")," behaves similarly to ",l.createElement(t.code,null,"eth_call"),". When validation is enabled, the simulation closely approximates real EVM block creation, except it skips transaction signature checks and allows direct transactions from contracts."),"\n",l.createElement(t.h3,{id:"zero-base-fee"},"Zero Base Fee"),"\n",l.createElement(t.p,null,"When validation mode is disabled, the block's ",l.createElement(t.code,null,"baseFee")," is set to zero. This affects the BASEFEE opcode and the ",l.createElement(t.code,null,"baseFee")," returned by ",l.createElement(t.code,null,"eth_simulate"),". Additionally, the base fee does not auto-adjust based on the parent block, even if the user overrides the previous block's ",l.createElement(t.code,null,"baseFee"),"."),"\n",l.createElement(t.p,null,"This behavior is intentional to enable free transactions in ",l.createElement(t.code,null,"eth_simulate"),", allowing users to avoid adding boilerplate code to give themselves ETH using a balance override. While similar results could be achieved by skipping balance validation, it would be inconsistent with EVM operations."),"\n",l.createElement(t.h2,{id:"failures"},"Failures"),"\n",l.createElement(t.p,null,"It is possible that user defines a transaction that cannot be included in the Ethereum block as it breaks the rules of EVM. For example, if transactions nonce is too high or low, baseFeePerGas is too low etc. In these situations the execution of eth_simulate ends and an error is returned."),"\n",l.createElement(t.h2,{id:"version-number"},"Version number"),"\n",l.createElement(t.p,null,"The method name for eth_simulate ",l.createElement(t.code,null,"eth_simulateV1")," the intention is that after release of eth_simulate, if new features are wanted the ",l.createElement(t.code,null,"eth_simulateV1")," is kept as it is, and instead ",l.createElement(t.code,null,"eth_simulateV2")," is published with the new wanted features."),"\n",l.createElement(t.h2,{id:"clients-can-set-their-own-limits"},"Clients can set their own limits"),"\n",l.createElement(t.p,null,"Clients may introduce their own limits to prevent DOS attacks using the method. We have thought of three such standard limits"),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"How many blocks can be defined in ",l.createElement(t.code,null,"BlockStateCalls"),". The suggested default for this is 256 blocks"),"\n",l.createElement(t.li,null,"A global gas limit (similar to the same limit for ",l.createElement(t.code,null,"eth_call"),"). The eth_simulate cannot exceed the global gas limit over its lifespan"),"\n",l.createElement(t.li,null,"The clients can set their own limit on how big the input JSON payload can be. A suggested default for this is 30mb"),"\n"),"\n",l.createElement(t.h2,{id:"rationale"},"Rationale"),"\n",l.createElement(t.h3,{id:"pre-computed-calls"},"Pre-computed calls"),"\n",l.createElement(t.p,null,"When it comes to contract override behavior, specifically precompile override, there were two approaches:"),"\n",l.createElement(t.ol,null,"\n",l.createElement(t.li,null,"As specified above to allow replacement of precompiles by EVM code and to allow those same precompiles to be relocated to another access for fallback behavior."),"\n",l.createElement(t.li,null,"Allow users to pass in a set of pre-computed calls for an address, i.e. direct mapping of input to output."),"\n"),"\n",l.createElement(t.p,null,"The second approach has better UX for simple use-cases such as faking a signature via ecrecover. It also allows for getting the same gas usage as a real precompile execution. The simpler UX comes at cost of flexibility. Overriding with EVM code is general. It also imposes changes to the EVM interpreter code, which has been otherwise avoided, without enabling new features. Hence the spec proposes the first alternative."))}var s=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,a.RP)(),e.components);return t?l.createElement(t,e,l.createElement(r,e)):r(e)},c=n(24794),o=n(33551),i=n(87164),d=n(64155),u=n(91890);const m={h1:e=>l.createElement(o.A,Object.assign({variant:"h1"},e)),h2:e=>l.createElement(o.A,Object.assign({variant:"h2"},e)),h3:e=>l.createElement(o.A,Object.assign({variant:"h3"},e)),h4:e=>l.createElement(o.A,Object.assign({variant:"h4"},e)),h5:e=>l.createElement(o.A,Object.assign({variant:"h5"},e)),h6:e=>l.createElement(o.A,Object.assign({variant:"h6"},e)),p:e=>l.createElement(o.A,Object.assign({paragraph:!0},e)),a:e=>l.createElement(c.Link,e),pre:e=>l.createElement(i.A,Object.assign({component:"pre",sx:{overflowX:"auto",p:2,bgcolor:"background.paper",borderRadius:1,mb:2}},e)),code:e=>l.createElement(i.A,Object.assign({component:"code",sx:{fontFamily:"monospace",p:.5,borderRadius:.5}},e))},h=e=>{let{children:t,pageContext:n}=e;return l.createElement(l.Fragment,null,l.createElement(d.A,{elevation:0,sx:{p:3,mb:4}},l.createElement(a.xA,{components:m},t),l.createElement(u.A,{next:n.next,prev:n.prev})))};function b(e){return l.createElement(h,e,l.createElement(s,e))}}}]);
//# sourceMappingURL=component---node-modules-gatsby-openrpc-theme-src-templates-default-tsx-content-file-path-src-docs-ethsimulatev-1-notes-md-2d48be0947826e773737.js.map